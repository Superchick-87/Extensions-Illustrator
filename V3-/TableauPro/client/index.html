<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Tableau Pro V83</title>
    <link rel="stylesheet" href="css/style.css?v=21">
    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
    <script src="js/papaparse.min.js"></script>
    <script>if (window.module) module = window.module;</script>
    <script src="js/CSInterface.js"></script> 
</head>
<body>
    <div class="container">
        
        <div class="header">
            <h2>Tableau Pro V83</h2>
            <button class="reload-btn" onclick="location.reload()">⟳</button>
        </div>

        <div class="section-file">
            <div class="group-title" style="margin-top:0;">Fichier source & Options</div>
            <div id="fileNameDisplay" style="color:#aaa; font-style:italic; font-size:11px; margin-bottom:5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Aucun fichier sélectionné</div>
            <input type="file" id="fileInput" accept=".csv, .txt" style="display:none;">
            <button id="btnImport" class="action-btn primary" style="margin-bottom:10px;">CHOISIR UN FICHIER</button>

            <div class="file-cols">
                <div class="file-col-half">
                    <label style="font-weight:bold; margin-bottom:5px; display:block; font-size:11px;">Lignes à afficher :</label>
                    <div class="control-row" style="justify-content: flex-start; gap: 5px;">
                        <div style="display:flex; align-items:center;">
                            <input type="checkbox" id="cbNbLines" style="margin:0 5px 0 0;" checked>
                            <label for="cbNbLines" style="cursor:pointer; font-size:11px;">Limiter à :</label>
                        </div>
                        <div id="wrapNbLines" class="number-wrapper"><input type="number" id="valNbLines" value="10" min="1"></div>
                    </div>
                    <div class="control-row" style="margin-top:5px;">
                        <div style="display:flex; align-items:center;">
                            <label style="width:35px;">Début:</label><div class="number-wrapper"><input type="number" id="rowStart" value="0" min="0"></div>
                        </div>
                        <div id="wrapRowEnd" style="display:flex; align-items:center; margin-left:5px;">
                            <label style="width:25px; text-align:right; margin-right:5px;">Fin:</label><div class="number-wrapper input-disabled"><input type="number" id="rowEnd" value="0" min="0" disabled></div>
                        </div>
                    </div>
                </div>
                <div class="file-col-half col-separator">
                    <label style="font-weight:bold; margin-bottom:8px; display:block;">Bloc titre :</label>
                    <div style="display:flex; align-items:center;">
                        <input type="checkbox" id="cbShowTitle" checked>
                        <label for="cbShowTitle" style="cursor:pointer; margin-left:5px;">Afficher</label>
                    </div>
                </div>
            </div>
            
            <div style="margin-top:10px;">
                <label style="font-weight:bold; font-size:11px; display:block; margin-bottom:3px;">Légende :</label>
                <textarea id="legendText" rows="2" style="width:100%; font-family: sans-serif; font-size:11px; border:1px solid #444; background:#2a2a2a; color:#eee; padding:5px;" placeholder="Texte de légende..."></textarea>
            </div>
            <div id="rangeWarning" class="warning-msg" style="display:none;">⚠ "Début" > "Fin".</div>
        </div>
        
        <div class="section-separator" onclick="toggleSection('sec-datas', this)">
            <div style="display:flex; align-items:center; gap:5px;"><span class="chevron">▼</span><span>DATAS</span></div>
            <button id="btnRaz" class="raz-btn" onclick="event.stopPropagation()">RAZ</button>
        </div>
        
        <div id="sec-datas" class="collapsible-content">
            <div class="tabs">
                <button class="tab-btn active" data-tab="tab-display" data-group="data">Affichage</button>
                <button class="tab-btn" data-tab="tab-highlight" data-group="data">Mise en valeur</button>
            </div>

            <div id="tab-display" class="tab-content active" data-group="data">
                <p style="color:#888; font-size:11px; margin:5px 0;">Triez (A-Z) ou filtrez les colonnes.</p>
                <div id="filterContainer" class="filter-list"><div style="padding:10px; color:#666; text-align:center;">Chargez un fichier...</div></div>
            </div>

            <div id="tab-highlight" class="tab-content" data-group="data">
                <div class="rule-builder">
                    <div class="control-row"><label>Colonne :</label><select id="ruleCol" style="width:120px;"><option>-</option></select></div>
                    <div class="control-row"><label>Condition :</label>
                        <select id="ruleOp" style="width:120px;">
                            <option value="=">=</option><option value=">">></option><option value=">=">>=</option>
                            <option value="<"><</option><option value="<="><=</option><option value="between">Entre</option><option value="contains">Contient</option>
                        </select>
                    </div>
                    <div class="control-row" id="ruleValContainer"><label>Valeur :</label><input type="text" id="ruleVal" placeholder="ex: 50" style="width:120px; text-align:left;"></div>
                    <div class="control-row" id="ruleValBetween" style="display:none;">
                        <label>De:</label><input type="text" id="ruleValA" style="width:50px;">
                        <label>à:</label><input type="text" id="ruleValB" style="width:50px;">
                    </div>
                    <div class="control-row"><label>Cible :</label>
                        <div style="display:flex; gap:10px;">
                            <label><input type="radio" name="ruleScope" value="cell" checked> Cellule</label>
                            <label><input type="radio" name="ruleScope" value="row"> Ligne</label>
                        </div>
                    </div>
                    <div style="margin-top:10px; border-top:1px solid #444; padding-top:5px;">
                        <label style="font-size:11px; color:#aaa; margin-bottom:5px; display:block;">Styles à appliquer :</label>
                        <div id="ui-ruleBg"></div><div id="ui-ruleTxt" style="margin-top:5px;"></div>
                    </div>
                    <button id="btnAddRule" class="action-btn" style="background:#444; margin-top:10px; font-size:11px; padding:5px;">AJOUTER LA RÈGLE</button>
                </div>
                <div class="group-title">Règles actives</div>
                <div id="rulesList" class="col-list" style="height:100px;"></div>
            </div>
        </div>

        <div class="section-separator" onclick="toggleSection('sec-aspect', this)">
            <div style="display:flex; align-items:center; gap:5px;"><span class="chevron">▼</span><span>ASPECT DU TABLEAU</span></div>
        </div>

        <div id="sec-aspect" class="collapsible-content">
            <div class="tabs">
                <button class="tab-btn active" data-tab="tab-geo" data-group="aspect">Style</button>
                <button class="tab-btn" data-tab="tab-colors" data-group="aspect">Couleurs</button>
                <button class="tab-btn" data-tab="tab-cols" data-group="aspect">Colonnes</button>
            </div>

            <div id="tab-geo" class="tab-content active" data-group="aspect">
                <div class="sub-tabs">
                    <button class="sub-tab-btn active" data-subtab="style-typo">Typographie</button>
                    <button class="sub-tab-btn" data-subtab="style-cell">Cellule</button>
                    <button class="sub-tab-btn" data-subtab="style-bord">Bordures</button>
                </div>
                <div id="style-typo" class="sub-tab-content active">
                    <div class="control-row"><input type="text" id="fontFilter" placeholder="Filtrer les polices…" style="width:240px; margin-bottom:4px;"><label>Police :</label><select id="fName" style="width: 160px;"><option>Chargement...</option></select></div>
                    <div class="control-row"><label>Taille :</label><div class="number-wrapper"><input type="number" id="fSize" value="10"><span class="unit-symbol">pt</span></div></div>
                    <div class="control-row"><label>Interligne :</label><div class="number-wrapper"><input type="number" id="fLeading" value="12"><span class="unit-symbol">pt</span></div></div>
                    <div class="control-row"><label>Gras (Titre):</label><input type="checkbox" id="isBold" checked></div>
                </div>
                <div id="style-cell" class="sub-tab-content">
                    <div class="control-row"><label>H. Titre :</label><div class="number-wrapper"><input type="number" id="hHead" value="15"><span class="unit-symbol">mm</span></div></div>
                    <div class="control-row"><label>H. Ligne :</label><div class="number-wrapper"><input type="number" id="hRow" value="10"><span class="unit-symbol">mm</span></div></div>
                    <div class="control-row"><label>Marge int. :</label><div class="number-wrapper"><input type="number" id="pad" value="4"><span class="unit-symbol">mm</span></div></div>
                    <div class="control-row"><label>Wrap Titre:</label><input type="checkbox" id="wrapHead"></div>
                    <div style="margin-top:10px; border-top:1px solid #444; padding-top:8px;">
                        <label style="font-weight:bold; display:block; margin-bottom:8px;">Arrondis (mm) :</label>
                        <div style="display:flex; justify-content:space-between; gap:10px;">
                            <div style="flex:1;">
                                <div style="font-size:12px; font-weight:bold; color:#fff; margin-bottom:5px; text-align:center; text-transform:uppercase;">TABLEAU</div>
                                <div style="display:flex; justify-content:space-between; gap:2px; margin-bottom:2px;"><div class="number-wrapper"><input type="number" id="radTL" placeholder="0"><span class="unit-symbol">◤</span></div><div class="number-wrapper"><input type="number" id="radTR" placeholder="0"><span class="unit-symbol">◥</span></div></div>
                                <div style="display:flex; justify-content:space-between; gap:2px; margin-bottom:5px;"><div class="number-wrapper"><input type="number" id="radBL" placeholder="0"><span class="unit-symbol">◣</span></div><div class="number-wrapper"><input type="number" id="radBR" placeholder="0"><span class="unit-symbol">◢</span></div></div>
                                <div class="control-row" style="margin:0;"><div class="number-wrapper" style="width:100%;"><input type="number" id="radGlobal" placeholder="Global"><span class="unit-symbol">G</span></div></div>
                            </div>
                            <div style="flex:1;" id="legRadiusContainer">
                                <div style="font-size:12px; font-weight:bold; color:#fff; margin-bottom:5px; text-align:center; text-transform:uppercase;">LÉGENDE</div>
                                <div style="display:flex; justify-content:space-between; gap:2px; margin-bottom:2px;"><div class="number-wrapper"><input type="number" id="legRadTL" placeholder="0"><span class="unit-symbol">◤</span></div><div class="number-wrapper"><input type="number" id="legRadTR" placeholder="0"><span class="unit-symbol">◥</span></div></div>
                                <div style="display:flex; justify-content:space-between; gap:2px; margin-bottom:5px;"><div class="number-wrapper"><input type="number" id="legRadBL" placeholder="0"><span class="unit-symbol">◣</span></div><div class="number-wrapper"><input type="number" id="legRadBR" placeholder="0"><span class="unit-symbol">◢</span></div></div>
                                <div class="control-row" style="margin:0;"><div class="number-wrapper" style="width:100%;"><input type="number" id="legRadGlobal" placeholder="Global"><span class="unit-symbol">G</span></div></div>
                            </div>
                        </div>
                        <div class="control-row" style="margin-top:8px; justify-content: center; background:#2a2a2a; padding:4px; border-radius:3px;"><input type="checkbox" id="syncRadius" checked><label for="syncRadius" style="cursor:pointer; margin-left:5px; font-size:11px;">Lier Tableau et Légende</label></div>
                    </div>
                </div>
                <div id="style-bord" class="sub-tab-content">
                    <div class="control-row" style="border-bottom:1px solid #444; padding-bottom:5px; margin-bottom:5px;"><label style="font-weight:bold;">Toutes :</label><input type="checkbox" id="bAll" checked></div>
                    <div class="control-row"><label>Verticales:</label><input type="checkbox" id="bVert" checked></div>
                    <div class="control-row"><label>Horizontales:</label><input type="checkbox" id="bHorz" checked></div>
                    <div class="control-row"><label>Sous-Titre:</label><input type="checkbox" id="bHead" checked></div>
                    <div class="control-row"><label>Extérieur:</label><input type="checkbox" id="bOuter" checked></div>
                    <div class="control-row"><label>Epaisseur:</label><select id="bWeight"><option value="0.25">0.25 pt</option><option value="0.5" selected>0.5 pt</option><option value="1">1 pt</option></select></div>
                </div>
            </div>

            <div id="tab-colors" class="tab-content" data-group="aspect">
                <div class="sub-tabs"><button class="sub-tab-btn active" data-subtab="sub-titre">Titre</button><button class="sub-tab-btn" data-subtab="sub-liste">Liste</button><button class="sub-tab-btn" data-subtab="sub-legende">Légende</button></div>
                <div id="sub-titre" class="sub-tab-content active"><div id="ui-cBgHead"></div><div id="ui-cTxtHead"></div><div id="ui-cStrokeHead" style="margin-top:10px; border-top:1px solid #444; padding-top:10px;"></div></div>
                <div id="sub-liste" class="sub-tab-content"><div id="ui-cBgRow1"></div><div id="ui-cBgRow2"></div><div id="ui-cTxtCont"></div></div>
                <div id="sub-legende" class="sub-tab-content"><div id="ui-cBgLeg"></div><div id="ui-cTxtLeg" style="margin-top:10px; border-top:1px solid #444; padding-top:10px;"></div></div>
            </div>

            <div id="tab-cols" class="tab-content" data-group="aspect">
                <p style="color:#888; font-size:11px; margin:0 0 10px 0;">Glissez pour réorganiser. Shift+Click pour plage. Ctrl+Click pour ajout.</p>
                <div id="colList" class="col-list"></div>
            </div>
        </div>
    </div>

    <div class="footer"><button id="btnApply" class="action-btn primary" style="width: 100%;">APPLIQUER</button></div>
    <script src="js/main.js"></script>
</body>
</html>